{% load static %}

<button 
    type="button"
    class="btn btn-sm btn-primary"
    data-mfp-src="#metadata-modal-{{ obj.pk }}">
    Metadata
</button>

<div id="metadata-modal-{{ obj.pk }}" class="white-popup mfp-hide">
    <div class="modal-header">
        <h5 class="modal-title">Tracking Details</h5>
        <button type="button" class="mfp-close">&times;</button>
    </div>
    <div class="modal-body">
        <div id="tabbed-changeform-tabs" class="tabbed-changeform-tabs">
            {% if warnings %}
            <button id="tablink-warnings-{{ obj.pk }}" class="tabbed-changeform-tablink active" onclick="AdminInterface.tabbedChangeForm.openTab(event, 'warnings-{{ obj.pk }}')">üìã Warnings</button>
            {% endif %}
            {% if headers_data %}
            <button id="tablink-headers-{{ obj.pk }}" class="tabbed-changeform-tablink active" onclick="AdminInterface.tabbedChangeForm.openTab(event, 'headers-{{ obj.pk }}')">üìã Headers</button>
            {% endif %}
            {% if ip_data %}
            <button id="tablink-ip-{{ obj.pk }}" class="tabbed-changeform-tablink {% if not headers_data %}active{% endif %}" onclick="AdminInterface.tabbedChangeForm.openTab(event, 'ip-{{ obj.pk }}')">üåê IP Address</button>
            {% endif %}
            {% if user_agent_data %}
            <button id="tablink-ua-{{ obj.pk }}" class="tabbed-changeform-tablink {% if not headers_data and not ip_data %}active{% endif %}" onclick="AdminInterface.tabbedChangeForm.openTab(event, 'ua-{{ obj.pk }}')">üñ•Ô∏è User Agent</button>
            {% endif %}
            {% if form_data %}
            <button id="tablink-form-{{ obj.pk }}" class="tabbed-changeform-tablink {% if not headers_data and not ip_data and not user_agent_data %}active{% endif %}" onclick="AdminInterface.tabbedChangeForm.openTab(event, 'form-{{ obj.pk }}')">üìù Form Data</button>
            {% endif %}
        </div>

        {% if warnings %}
        <div id="tabcontent-warnings-{{ obj.pk }}" class="tabbed-changeform-tabcontent active">
            <ul>
                {% for warning in warnings %}
                <li>{{ warning }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
        {% if headers_data %}
        <div id="tabcontent-headers-{{ obj.pk }}" class="tabbed-changeform-tabcontent active">
            <pre class="metadata-content">{{ headers_data|pprint }}</pre>
        </div>
        {% endif %}
        {% if ip_data %}
        <div id="tabcontent-ip-{{ obj.pk }}" class="tabbed-changeform-tabcontent {% if not headers_data %}active{% endif %}">
            <pre class="metadata-content">{{ ip_data|pprint }}</pre>
        </div>
        {% endif %}
        {% if user_agent_data %}
        <div id="tabcontent-ua-{{ obj.pk }}" class="tabbed-changeform-tabcontent {% if not headers_data and not ip_data %}active{% endif %}">
            <pre class="metadata-content">{{ user_agent_data|pprint }}</pre>
        </div>
        {% endif %}
        {% if form_data %}
        <div id="tabcontent-form-{{ obj.pk }}" class="tabbed-changeform-tabcontent {% if not headers_data and not ip_data and not user_agent_data %}active{% endif %}">
            <pre class="metadata-content">{{ form_data|pprint }}</pre>
        </div>
        {% endif %}
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-primary" onclick="django.jQuery.magnificPopup.close()">Close</button>
    </div>
</div>

<style>
.metadata-content {
    background-color: #f8f9fa;
    padding: 0.5rem;
    border-radius: 4px;
    max-height: 800px;
    overflow-y: auto;
    margin: 0;
}
.metadata-content pre {
    margin: 0;
    white-space: pre-wrap;
}
.white-popup {
    position: relative;
    background: #FFF;
    padding: 15px;
    width: auto;
    max-width: 800px;
    margin: 20px auto;
    border-radius: 4px;
}
.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
    padding: 0;
}
.modal-title {
    margin: 0;
    font-size: 1.1rem;
}
.modal-body {
    padding: 0;
}
.modal-footer {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #dee2e6;
    text-align: right;
}
.mfp-close {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    padding: 0;
    margin: 0;
}
.tabbed-changeform-tabs {
    margin: 0 0 0.5rem 0 !important;
    padding: 0 !important;
}
.tabbed-changeform-tablink {
    margin: 0 !important;
    padding: 0.5rem 1rem !important;
}
.tabbed-changeform-tabcontent {
    padding: 0 !important;
    margin: 0 !important;
}
</style>

<script type="application/javascript">
django.jQuery(document).ready(function($) {
    $('.btn-primary[data-mfp-src]').magnificPopup({
        type: 'inline',
        preloader: false,
        focus: '#name',
        callbacks: {
            beforeOpen: function() {
                if($(window).width() < 700) {
                    this.st.focus = false;
                } else {
                    this.st.focus = '#name';
                }
            }
        },
        mainClass: 'mfp-fade',
        removalDelay: 300,
        fixedContentPos: true,
        fixedBgPos: true,
        overflowY: 'auto',
        closeOnBgClick: true,
        closeOnContentClick: false,
        closeBtnInside: true,
        midClick: true,
        tClose: 'Close (Esc)',
        tLoading: 'Loading...',
        autoFocusLast: false,
        modal: true,
        alignTop: false,
        closeMarkup: '<button title="%title%" type="button" class="mfp-close">&#215;</button>',
        showCloseBtn: true,
        enableEscapeKey: true,
        callbacks: {
            beforeOpen: function() {
                this.st.image.markup = this.st.image.markup.replace('mfp-figure', 'mfp-figure mfp-with-anim');
                this.st.mainClass = 'mfp-zoom-in';
            },
            open: function() {
                // Set modal height to 75% of viewport height
                var modal = this.st.el;
                var viewportHeight = $(window).height();
                var modalHeight = viewportHeight * 0.75;
                $(modal).css('max-height', modalHeight + 'px');
            }
        }
    });
});
</script> 